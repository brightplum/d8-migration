name: 'app'
type: 'php:7.1'

runtime:
  extensions:
  - redis

variables:
  php:
    memory_limit: 256M
    post_max_size: 128M
    upload_max_filesize: 128M

relationships:
  database: 'mysqldb:mysql'
  solr: 'solrsearch:solr'
  redis: 'rediscache:redis'

disk: 10000

dependencies:
  php:
    "drush/drush": "^8.0"

mounts:
  '/web/sites/default/files': 'shared:files/files'
  '/tmp': 'shared:files/tmp'
  '/files-private': 'shared:files/private'
  '/drush-backups': 'shared:files/drush-backups'

build:
  flavor: drupal

hooks:
  deploy: |
    cd web
    drush -y cache-rebuild
    drush -y updatedb
    drush -y entup
web:
  locations:
    '/':
      root: 'web'
      expires: 5m
      passthru: '/index.php'
      allow: false
      rules:
        # Allow access to common static files.
        '\.(jpe?g|png|gif|svgz?|css|js|map|ico|bmp|eot|woff2?|otf|ttf|csv)$':
          allow: true
        '^/robots\.txt$':
          allow: true
        '^/sitemap\.xml$':
          allow: true
    '/sites/default/files':
      allow: true
      expires: 5m
      passthru: '/index.php'
      root: 'web/sites/default/files'
      scripts: false
      rules:
        '^/sites/default/files/(css|js)':
          expires: 2w

crons:
  drupal:
    spec: '*/10 * * * *'
    cmd: 'cd web ; drush cron'
